{
  "issue_id": 1831,
  "issue_url": "https://github.com/google/gson/issues/1831",
  "title": "Gson.getAdapter((TypeToken) null) throws exception",
  "description": "<p dir=\"auto\">The <code class=\"notranslate\">Gson</code> class has logic for handling <code class=\"notranslate\">null</code> arguments for <code class=\"notranslate\">getAdapter(TypeToken)</code>, see:<br>\n<div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/google/gson/blob/ceae88bd6667f4263bbe02e6b3710b8a683906a2/gson/src/main/java/com/google/gson/Gson.java#L434\">gson/gson/src/main/java/com/google/gson/Gson.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 434\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/google/gson/commit/ceae88bd6667f4263bbe02e6b3710b8a683906a2\">ceae88b</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L434\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"434\"></td>\n          <td id=\"LC434\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-smi\">TypeAdapter</span><?> <span class=\"pl-s1\">cached</span> = <span class=\"pl-s1\">typeTokenCache</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s1\">type</span> == <span class=\"pl-c1\">null</span> ? <span class=\"pl-c1\">NULL_KEY_SURROGATE</span> : <span class=\"pl-s1\">type</span>); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>\n<p dir=\"auto\">However, it appears the pull request which tried to keep the support for <code class=\"notranslate\">null</code> arguments also broke it due to commit <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/google/gson/commit/31dcfa3ad6fff0ee64f0fc5b8a1712c3ef3dcf95/hovercard\" href=\"https://github.com/google/gson/commit/31dcfa3ad6fff0ee64f0fc5b8a1712c3ef3dcf95\"><tt>31dcfa3</tt></a> because it does not reassign a non-<code class=\"notranslate\">null</code> value to the <code class=\"notranslate\">type</code> argument anymore which later on in the method causes a <code class=\"notranslate\">NullPointerException</code>.</p>\n<p dir=\"auto\">However that was 4 years ago and it appears support for <code class=\"notranslate\">null</code> arguments might not have been used much (if at all; I did not find existing issues about this here on GitHub). Therefore maybe it would be better instead of fixing this issue to simply remove <code class=\"notranslate\">null</code> handling for <code class=\"notranslate\">getAdapter(TypeToken)</code> completely and to throw an exception on purpose.</p>",
  "description_text": "The Gson class has logic for handling null arguments for getAdapter(TypeToken), see:\n\n\n\ngson/gson/src/main/java/com/google/gson/Gson.java\n\n\n         Line 434\n      in\n      ceae88b\n\n\n\n\n\n\n TypeAdapter cached = typeTokenCache.get(type == null ? NULL_KEY_SURROGATE : type); \n\n\n\n\n\nHowever, it appears the pull request which tried to keep the support for null arguments also broke it due to commit 31dcfa3 because it does not reassign a non-null value to the type argument anymore which later on in the method causes a NullPointerException.\nHowever that was 4 years ago and it appears support for null arguments might not have been used much (if at all; I did not find existing issues about this here on GitHub). Therefore maybe it would be better instead of fixing this issue to simply remove null handling for getAdapter(TypeToken) completely and to throw an exception on purpose."
}