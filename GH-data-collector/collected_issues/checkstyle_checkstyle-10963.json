{
  "issue_id": 10962,
  "issue_url": "https://github.com/checkstyle/checkstyle/issues/10962",
  "title": "NPE in EqualsAvoidNull check when accessing string from base class with 'this' qualifier",
  "description": "<p dir=\"auto\">Checkstyle ends with a NPE when a derived class accesses an String variable from a base class when the variable is accessed via 'this' qualifier. The check runs fine when the 'this.' is omitted.</p>\n<p dir=\"auto\">This error appeared first in the Checkstyle version 8.29 we currently use but can be reprodued with the latest 9.1 version.<br>\nIt appears on the checkstyle command line (as in the sample below), withing the checkstyle maven plugin and in the checkstyle Eclipse plugin.</p>\n<p dir=\"auto\"><strong>The below command sequence demonstrates the error:</strong></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"C:\\Temp\\test>type AbstractBaseClass.java \npackage com.fsp.test;\n\npublic abstract class AbstractBaseClass\n{\n   protected String stringFromBaseClass = \"ABC\";\n}\n\nC:\\Temp\\test>type DerivedClass.java \npackage com.fsp.test;\n\npublic class DerivedClass extends AbstractBaseClass\n{\n   public DerivedClass()\n   {\n      if ( this.stringFromBaseClass.equals(\"JKHKJ\") ) System.out.println(\"Hello\");\n   }\n}\n\nC:\\Temp\\test>type checkstyle-config.xml \n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE module PUBLIC \"-//Puppy Crawl//DTD Check Configuration 1.3//EN\" \"http://www.puppycrawl.com/dtds/configuration_1_3.dtd\">\n<module name=\"Checker\">\n  <property name=\"fileExtensions\" value=\"java\"/>\n  <module name=\"TreeWalker\">\n    <module name=\"EqualsAvoidNull\"/>\n  </module>\n</module>\n\nC:\\Temp\\test>java -Duser.language=en -Duser.country=US -jar c:\\temp\\checkstyle-9.1-all.jar -c checkstyle-config.xml  AbstractBaseClass.java DerivedClass.java \nStarting audit...\ncom.puppycrawl.tools.checkstyle.api.CheckstyleException: Exception was thrown while processing DerivedClass.java\n\tat com.puppycrawl.tools.checkstyle.Checker.processFiles(Checker.java:302)\n\tat com.puppycrawl.tools.checkstyle.Checker.process(Checker.java:221)\n\tat com.puppycrawl.tools.checkstyle.Main.runCheckstyle(Main.java:409)\n\tat com.puppycrawl.tools.checkstyle.Main.runCli(Main.java:332)\n\tat com.puppycrawl.tools.checkstyle.Main.execute(Main.java:191)\n\tat com.puppycrawl.tools.checkstyle.Main.main(Main.java:126)\nCaused by: java.lang.NullPointerException\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.getFieldType(EqualsAvoidNullCheck.java:545)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.isStringFieldOrVariableFromThisInstance(EqualsAvoidNullCheck.java:481)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.isCalledOnStringFieldOrVariable(EqualsAvoidNullCheck.java:439)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.checkMethodCall(EqualsAvoidNullCheck.java:356)\n\tat java.lang.Iterable.forEach(Iterable.java:75)\n\tat java.util.Collections$UnmodifiableCollection.forEach(Collections.java:1080)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.traverseFieldFrameTree(EqualsAvoidNullCheck.java:339)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.traverseFieldFrameTree(EqualsAvoidNullCheck.java:336)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.traverseFieldFrameTree(EqualsAvoidNullCheck.java:336)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.finishTree(EqualsAvoidNullCheck.java:242)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.notifyEnd(TreeWalker.java:319)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.walk(TreeWalker.java:274)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.processFiltered(TreeWalker.java:154)\n\tat com.puppycrawl.tools.checkstyle.api.AbstractFileSetCheck.process(AbstractFileSetCheck.java:87)\n\tat com.puppycrawl.tools.checkstyle.Checker.processFile(Checker.java:328)\n\tat com.puppycrawl.tools.checkstyle.Checker.processFiles(Checker.java:289)\n\t... 5 more\nCheckstyle ends with 1 errors.\"><pre class=\"notranslate\"><code>C:\\Temp\\test>type AbstractBaseClass.java \npackage com.fsp.test;\n\npublic abstract class AbstractBaseClass\n{\n   protected String stringFromBaseClass = \"ABC\";\n}\n\nC:\\Temp\\test>type DerivedClass.java \npackage com.fsp.test;\n\npublic class DerivedClass extends AbstractBaseClass\n{\n   public DerivedClass()\n   {\n      if ( this.stringFromBaseClass.equals(\"JKHKJ\") ) System.out.println(\"Hello\");\n   }\n}\n\nC:\\Temp\\test>type checkstyle-config.xml \n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE module PUBLIC \"-//Puppy Crawl//DTD Check Configuration 1.3//EN\" \"http://www.puppycrawl.com/dtds/configuration_1_3.dtd\">\n<module name=\"Checker\">\n  <property name=\"fileExtensions\" value=\"java\"/>\n  <module name=\"TreeWalker\">\n    <module name=\"EqualsAvoidNull\"/>\n  </module>\n</module>\n\nC:\\Temp\\test>java -Duser.language=en -Duser.country=US -jar c:\\temp\\checkstyle-9.1-all.jar -c checkstyle-config.xml  AbstractBaseClass.java DerivedClass.java \nStarting audit...\ncom.puppycrawl.tools.checkstyle.api.CheckstyleException: Exception was thrown while processing DerivedClass.java\n\tat com.puppycrawl.tools.checkstyle.Checker.processFiles(Checker.java:302)\n\tat com.puppycrawl.tools.checkstyle.Checker.process(Checker.java:221)\n\tat com.puppycrawl.tools.checkstyle.Main.runCheckstyle(Main.java:409)\n\tat com.puppycrawl.tools.checkstyle.Main.runCli(Main.java:332)\n\tat com.puppycrawl.tools.checkstyle.Main.execute(Main.java:191)\n\tat com.puppycrawl.tools.checkstyle.Main.main(Main.java:126)\nCaused by: java.lang.NullPointerException\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.getFieldType(EqualsAvoidNullCheck.java:545)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.isStringFieldOrVariableFromThisInstance(EqualsAvoidNullCheck.java:481)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.isCalledOnStringFieldOrVariable(EqualsAvoidNullCheck.java:439)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.checkMethodCall(EqualsAvoidNullCheck.java:356)\n\tat java.lang.Iterable.forEach(Iterable.java:75)\n\tat java.util.Collections$UnmodifiableCollection.forEach(Collections.java:1080)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.traverseFieldFrameTree(EqualsAvoidNullCheck.java:339)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.traverseFieldFrameTree(EqualsAvoidNullCheck.java:336)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.traverseFieldFrameTree(EqualsAvoidNullCheck.java:336)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.finishTree(EqualsAvoidNullCheck.java:242)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.notifyEnd(TreeWalker.java:319)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.walk(TreeWalker.java:274)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.processFiltered(TreeWalker.java:154)\n\tat com.puppycrawl.tools.checkstyle.api.AbstractFileSetCheck.process(AbstractFileSetCheck.java:87)\n\tat com.puppycrawl.tools.checkstyle.Checker.processFile(Checker.java:328)\n\tat com.puppycrawl.tools.checkstyle.Checker.processFiles(Checker.java:289)\n\t... 5 more\nCheckstyle ends with 1 errors.\n</code></pre></div>",
  "description_text": "Checkstyle ends with a NPE when a derived class accesses an String variable from a base class when the variable is accessed via 'this' qualifier. The check runs fine when the 'this.' is omitted.\nThis error appeared first in the Checkstyle version 8.29 we currently use but can be reprodued with the latest 9.1 version.\nIt appears on the checkstyle command line (as in the sample below), withing the checkstyle maven plugin and in the checkstyle Eclipse plugin.\nThe below command sequence demonstrates the error:\ntype DerivedClass.java \npackage com.fsp.test;\n\npublic class DerivedClass extends AbstractBaseClass\n{\n   public DerivedClass()\n   {\n      if ( this.stringFromBaseClass.equals(\"JKHKJ\") ) System.out.println(\"Hello\");\n   }\n}\n\nC:\\Temp\\test>type checkstyle-config.xml \n\n\n\n\n\n\n\n\n\nC:\\Temp\\test>java -Duser.language=en -Duser.country=US -jar c:\\temp\\checkstyle-9.1-all.jar -c checkstyle-config.xml  AbstractBaseClass.java DerivedClass.java \nStarting audit...\ncom.puppycrawl.tools.checkstyle.api.CheckstyleException: Exception was thrown while processing DerivedClass.java\n\tat com.puppycrawl.tools.checkstyle.Checker.processFiles(Checker.java:302)\n\tat com.puppycrawl.tools.checkstyle.Checker.process(Checker.java:221)\n\tat com.puppycrawl.tools.checkstyle.Main.runCheckstyle(Main.java:409)\n\tat com.puppycrawl.tools.checkstyle.Main.runCli(Main.java:332)\n\tat com.puppycrawl.tools.checkstyle.Main.execute(Main.java:191)\n\tat com.puppycrawl.tools.checkstyle.Main.main(Main.java:126)\nCaused by: java.lang.NullPointerException\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.getFieldType(EqualsAvoidNullCheck.java:545)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.isStringFieldOrVariableFromThisInstance(EqualsAvoidNullCheck.java:481)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.isCalledOnStringFieldOrVariable(EqualsAvoidNullCheck.java:439)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.checkMethodCall(EqualsAvoidNullCheck.java:356)\n\tat java.lang.Iterable.forEach(Iterable.java:75)\n\tat java.util.Collections$UnmodifiableCollection.forEach(Collections.java:1080)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.traverseFieldFrameTree(EqualsAvoidNullCheck.java:339)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.traverseFieldFrameTree(EqualsAvoidNullCheck.java:336)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.traverseFieldFrameTree(EqualsAvoidNullCheck.java:336)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.finishTree(EqualsAvoidNullCheck.java:242)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.notifyEnd(TreeWalker.java:319)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.walk(TreeWalker.java:274)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.processFiltered(TreeWalker.java:154)\n\tat com.puppycrawl.tools.checkstyle.api.AbstractFileSetCheck.process(AbstractFileSetCheck.java:87)\n\tat com.puppycrawl.tools.checkstyle.Checker.processFile(Checker.java:328)\n\tat com.puppycrawl.tools.checkstyle.Checker.processFiles(Checker.java:289)\n\t... 5 more\nCheckstyle ends with 1 errors.\">C:\\Temp\\test>type AbstractBaseClass.java \npackage com.fsp.test;\n\npublic abstract class AbstractBaseClass\n{\n   protected String stringFromBaseClass = \"ABC\";\n}\n\nC:\\Temp\\test>type DerivedClass.java \npackage com.fsp.test;\n\npublic class DerivedClass extends AbstractBaseClass\n{\n   public DerivedClass()\n   {\n      if ( this.stringFromBaseClass.equals(\"JKHKJ\") ) System.out.println(\"Hello\");\n   }\n}\n\nC:\\Temp\\test>type checkstyle-config.xml \n\n\n\n  \n  \n    \n  \n\n\nC:\\Temp\\test>java -Duser.language=en -Duser.country=US -jar c:\\temp\\checkstyle-9.1-all.jar -c checkstyle-config.xml  AbstractBaseClass.java DerivedClass.java \nStarting audit...\ncom.puppycrawl.tools.checkstyle.api.CheckstyleException: Exception was thrown while processing DerivedClass.java\n\tat com.puppycrawl.tools.checkstyle.Checker.processFiles(Checker.java:302)\n\tat com.puppycrawl.tools.checkstyle.Checker.process(Checker.java:221)\n\tat com.puppycrawl.tools.checkstyle.Main.runCheckstyle(Main.java:409)\n\tat com.puppycrawl.tools.checkstyle.Main.runCli(Main.java:332)\n\tat com.puppycrawl.tools.checkstyle.Main.execute(Main.java:191)\n\tat com.puppycrawl.tools.checkstyle.Main.main(Main.java:126)\nCaused by: java.lang.NullPointerException\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.getFieldType(EqualsAvoidNullCheck.java:545)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.isStringFieldOrVariableFromThisInstance(EqualsAvoidNullCheck.java:481)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.isCalledOnStringFieldOrVariable(EqualsAvoidNullCheck.java:439)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.checkMethodCall(EqualsAvoidNullCheck.java:356)\n\tat java.lang.Iterable.forEach(Iterable.java:75)\n\tat java.util.Collections$UnmodifiableCollection.forEach(Collections.java:1080)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.traverseFieldFrameTree(EqualsAvoidNullCheck.java:339)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.traverseFieldFrameTree(EqualsAvoidNullCheck.java:336)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.traverseFieldFrameTree(EqualsAvoidNullCheck.java:336)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.EqualsAvoidNullCheck.finishTree(EqualsAvoidNullCheck.java:242)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.notifyEnd(TreeWalker.java:319)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.walk(TreeWalker.java:274)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.processFiltered(TreeWalker.java:154)\n\tat com.puppycrawl.tools.checkstyle.api.AbstractFileSetCheck.process(AbstractFileSetCheck.java:87)\n\tat com.puppycrawl.tools.checkstyle.Checker.processFile(Checker.java:328)\n\tat com.puppycrawl.tools.checkstyle.Checker.processFiles(Checker.java:289)\n\t... 5 more\nCheckstyle ends with 1 errors.\n"
}