{
  "issue_id": 11365,
  "issue_url": "https://github.com/checkstyle/checkstyle/issues/11365",
  "title": "FinalClassCheck: False positive with anonymous classes",
  "description": "<p dir=\"auto\">I have read check documentation: <a href=\"https://checkstyle.sourceforge.io/config_design.html#FinalClass\" rel=\"nofollow\">https://checkstyle.sourceforge.io/config_design.html#FinalClass</a><br>\nI have downloaded the latest checkstyle from: <a href=\"https://checkstyle.org/cmdline.html#Download_and_Run\" rel=\"nofollow\">https://checkstyle.org/cmdline.html#Download_and_Run</a><br>\nI have executed the cli and showed it below, as cli describes the problem better than 1,000 words</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"/var/tmp $ javac Test.java\n\n/var/tmp $ cat config.xml\"><pre>/var/tmp $ javac Test.java\n\n/var/tmp $ cat config.xml</pre></div>\n<div class=\"highlight highlight-text-xml notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"<?xml version=\"1.0\"?>\n<!DOCTYPE module PUBLIC\n        \"-//Checkstyle//DTD Checkstyle Configuration 1.3//EN\"\n        \"https://checkstyle.org/dtds/configuration_1_3.dtd\">\n<module name=\"Checker\">\n    <module name=\"TreeWalker\">\n        <module name=\"FinalClass\"/>\n    </module>\n</module>\"><pre><?<span class=\"pl-ent\">xml</span><span class=\"pl-e\"> version</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>1.0<span class=\"pl-pds\">\"</span></span>?>\n<!<span class=\"pl-ent\">DOCTYPE</span> <span class=\"pl-e\">module</span> PUBLIC\n        \"-//Checkstyle//DTD Checkstyle Configuration 1.3//EN\"\n        \"https://checkstyle.org/dtds/configuration_1_3.dtd\">\n<<span class=\"pl-ent\">module</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Checker<span class=\"pl-pds\">\"</span></span>>\n    <<span class=\"pl-ent\">module</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>TreeWalker<span class=\"pl-pds\">\"</span></span>>\n        <<span class=\"pl-ent\">module</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>FinalClass<span class=\"pl-pds\">\"</span></span>/>\n    </<span class=\"pl-ent\">module</span>>\n</<span class=\"pl-ent\">module</span>></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"/var/tmp $ cat Test.java\"><pre class=\"notranslate\"><code>/var/tmp $ cat Test.java\n</code></pre></div>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"public class Test {\n\n    class a { // expected no violation\n        private a() {\n        }\n    }\n\n    a obj = new a() {\n    };\n}\"><pre><span class=\"pl-k\">public</span> <span class=\"pl-k\">class</span> <span class=\"pl-smi\">Test</span> {\n\n    <span class=\"pl-k\">class</span> <span class=\"pl-smi\">a</span> { <span class=\"pl-c\">// expected no violation</span>\n        <span class=\"pl-k\">private</span> <span class=\"pl-smi\">a</span>() {\n        }\n    }\n\n    <span class=\"pl-smi\">a</span> <span class=\"pl-s1\">obj</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">a</span>() {\n    };\n}</pre></div>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"/var/tmp $ RUN_LOCALE=\"-Duser.language=en -Duser.country=US\"\n/var/tmp $ java $RUN_LOCALE -jar checkstyle-10.0-all.jar -c config.xml Test.java\nStarting audit...\n[ERROR] /var/tmp/Test.java:3:5: Class a should be declared as final. [FinalClass]\nAudit done.\nCheckstyle ends with 1 errors.\"><pre>/var/tmp $ RUN_LOCALE=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-Duser.language=en -Duser.country=US<span class=\"pl-pds\">\"</span></span>\n/var/tmp $ java <span class=\"pl-smi\">$RUN_LOCALE</span> -jar checkstyle-10.0-all.jar -c config.xml Test.java\nStarting audit...\n[ERROR] /var/tmp/Test.java:3:5: Class a should be declared as final. [FinalClass]\nAudit done.\nCheckstyle ends with 1 errors.</pre></div>\n<hr>\n<p dir=\"auto\"><strong>Describe what you expect in detail.</strong></p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"/var/tmp $ RUN_LOCALE=\"-Duser.language=en -Duser.country=US\"\n/var/tmp $ java $RUN_LOCALE -jar checkstyle-10.0-all.jar -c config.xml Test.java\nStarting audit...\nAudit done.\"><pre>/var/tmp $ RUN_LOCALE=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-Duser.language=en -Duser.country=US<span class=\"pl-pds\">\"</span></span>\n/var/tmp $ java <span class=\"pl-smi\">$RUN_LOCALE</span> -jar checkstyle-10.0-all.jar -c config.xml Test.java\nStarting audit...\nAudit done.</pre></div>\n<p dir=\"auto\">This was supposed to be fixed in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"823742025\" data-permission-text=\"Title is private\" data-url=\"https://github.com/checkstyle/checkstyle/issues/9357\" data-hovercard-type=\"issue\" data-hovercard-url=\"/checkstyle/checkstyle/issues/9357/hovercard\" href=\"https://github.com/checkstyle/checkstyle/issues/9357\">#9357</a>. Making the class final results in a compile-time error.</p>",
  "description_text": "I have read check documentation: https://checkstyle.sourceforge.io/config_design.html#FinalClass\nI have downloaded the latest checkstyle from: https://checkstyle.org/cmdline.html#Download_and_Run\nI have executed the cli and showed it below, as cli describes the problem better than 1,000 words\n/var/tmp $ javac Test.java\n\n/var/tmp $ cat config.xml\n\n\n\n\n\n\n\">xml version=\"1.0\"?>\nDOCTYPE module PUBLIC\n        \"-//Checkstyle//DTD Checkstyle Configuration 1.3//EN\"\n        \"https://checkstyle.org/dtds/configuration_1_3.dtd\">\n<module name=\"Checker\">\n    <module name=\"TreeWalker\">\n        <module name=\"FinalClass\"/>\n    module>\nmodule>\n/var/tmp $ cat Test.java\n\npublic class Test {\n\n    class a { // expected no violation\n        private a() {\n        }\n    }\n\n    a obj = new a() {\n    };\n}\n/var/tmp $ RUN_LOCALE=\"-Duser.language=en -Duser.country=US\"\n/var/tmp $ java $RUN_LOCALE -jar checkstyle-10.0-all.jar -c config.xml Test.java\nStarting audit...\n[ERROR] /var/tmp/Test.java:3:5: Class a should be declared as final. [FinalClass]\nAudit done.\nCheckstyle ends with 1 errors.\n\nDescribe what you expect in detail.\n/var/tmp $ RUN_LOCALE=\"-Duser.language=en -Duser.country=US\"\n/var/tmp $ java $RUN_LOCALE -jar checkstyle-10.0-all.jar -c config.xml Test.java\nStarting audit...\nAudit done.\nThis was supposed to be fixed in #9357. Making the class final results in a compile-time error."
}