{
  "issue_id": 1771,
  "issue_url": "https://github.com/google/gson/issues/1771",
  "title": "JsonObject.entrySet() Entry.setValue(...) does not prevent null values",
  "description": "<p dir=\"auto\">The Map.Entry objects in the Set returned by <code class=\"notranslate\">JsonObject.entrySet()</code> do not validate the value passed to their <code class=\"notranslate\">Entry.setValue(...)</code> method, allowing Java <code class=\"notranslate\">null</code>s. This can cause runtime exceptions when the user of the JsonObject later expects that the values returned by JsonObject are never <code class=\"notranslate\">null</code>:</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"JsonObject jsonObject = new JsonObject();\njsonObject.addProperty(\"test\", 1);\njsonObject.entrySet().iterator().next().setValue(null);\n\nSystem.out.println(\"has=\" + jsonObject.has(\"test\"));\njsonObject.getAsJsonPrimitive(\"test\").toString(); // NullPointerException\"><pre><span class=\"pl-smi\">JsonObject</span> <span class=\"pl-s1\">jsonObject</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">JsonObject</span>();\n<span class=\"pl-s1\">jsonObject</span>.<span class=\"pl-en\">addProperty</span>(<span class=\"pl-s\">\"test\"</span>, <span class=\"pl-c1\">1</span>);\n<span class=\"pl-s1\">jsonObject</span>.<span class=\"pl-en\">entrySet</span>().<span class=\"pl-en\">iterator</span>().<span class=\"pl-en\">next</span>().<span class=\"pl-en\">setValue</span>(<span class=\"pl-c1\">null</span>);\n\n<span class=\"pl-smi\">System</span>.<span class=\"pl-s1\">out</span>.<span class=\"pl-en\">println</span>(<span class=\"pl-s\">\"has=\"</span> + <span class=\"pl-s1\">jsonObject</span>.<span class=\"pl-en\">has</span>(<span class=\"pl-s\">\"test\"</span>));\n<span class=\"pl-s1\">jsonObject</span>.<span class=\"pl-en\">getAsJsonPrimitive</span>(<span class=\"pl-s\">\"test\"</span>).<span class=\"pl-en\">toString</span>(); <span class=\"pl-c\">// NullPointerException</span></pre></div>\n<p dir=\"auto\">The Map.Entry objects should instead throw a NullPointerException when their <code class=\"notranslate\">setValue(...)</code> method is called with <code class=\"notranslate\">null</code> (as permitted by the <a href=\"https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Map.Entry.html#setValue(V)\" rel=\"nofollow\">documentation</a>).</p>",
  "description_text": "The Map.Entry objects in the Set returned by JsonObject.entrySet() do not validate the value passed to their Entry.setValue(...) method, allowing Java nulls. This can cause runtime exceptions when the user of the JsonObject later expects that the values returned by JsonObject are never null:\nJsonObject jsonObject = new JsonObject();\njsonObject.addProperty(\"test\", 1);\njsonObject.entrySet().iterator().next().setValue(null);\n\nSystem.out.println(\"has=\" + jsonObject.has(\"test\"));\njsonObject.getAsJsonPrimitive(\"test\").toString(); // NullPointerException\nThe Map.Entry objects should instead throw a NullPointerException when their setValue(...) method is called with null (as permitted by the documentation)."
}